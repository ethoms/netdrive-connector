#!/bin/sh

if [ $# -ne 3 ]
then
  echo ""
  echo "This command is intended to be used internally for the netdrive-connector application."
  echo ""
  echo "Usage: ${0} [password] [command] [args]"
  echo ""
  exit 1
fi

PASSWORD=$1
COMMAND=$2
PARMS=$3

SPAWN_CMD="su - root -c \"${COMMAND} ${PARMS}\""

echo ${SPAWN_CMD} > /tmp/netdrive-connector-spawn-cmd
chmod +x /tmp/netdrive-connector-spawn-cmd

expect -c "set timeout 12 ; spawn /tmp/netdrive-connector-spawn-cmd ; expect Password: ; send \"${PASSWORD}\r\" ; interact"

rm /tmp/netdrive-connector-spawn-cmd
